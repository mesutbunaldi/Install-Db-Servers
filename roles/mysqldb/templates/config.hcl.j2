consul {
  retry {
    enabled  = true
    attempts = 12
    backoff  = "250ms"
  }
}

once = true

{% for host in groups['webservers'] %}
template {
  source = "/etc/nginx/conf.d/{{ hostvars[host].inventory_hostname }}.conf.ctmpl"
  destination = "/etc/nginx/conf.d/{{ hostvars[host].inventory_hostname }}.conf"
  exec {
    command = "cat /etc/nginx/conf.d/{{ hostvars[host].inventory_hostname }}.conf"
  }
  backup = true
}
{% endfor %}

deduplicate {
  enabled = true
  prefix = "consul-template/dedup/"
}
